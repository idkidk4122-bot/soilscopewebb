<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoilScope | NASA-Powered Agricultural Intelligence</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGuOODqC6pVzHzZBdQ9dZx5GBkjJUHWMU&libraries=places"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-olive: #2E8B57;
            --secondary-olive: #3CB371;
            --primary-beige: #F5F5DC;
            --secondary-beige: #FFF8DC;
            --primary-brown: #8B4513;
            --secondary-brown: #A0522D;
            --aqua-blue: #20B2AA;
            --secondary-aqua: #48D1CC;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --bg-color: #f8f9fa;
            --text-color: #343a40;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --footer-bg: #ffffff;
            --border-color: #dee2e6;
            --sidebar-bg: #2E8B57;
            --sidebar-width: 260px;
            --sidebar-collapsed-width: 80px;
            --transition-speed: 0.3s;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.1);
            --chart-soil: #8B4513;
            --chart-water: #20B2AA;
            --chart-air: #2E8B57;
            --chart-organic: #32CD32;
        }

        [data-theme="dark"] {
            --bg-color: #1a1d23;
            --text-color: #e9ecef;
            --card-bg: #2d333b;
            --header-bg: #2d333b;
            --footer-bg: #2d333b;
            --border-color: #444c56;
            --light-gray: #343a40;
            --sidebar-bg: #1e6b4e;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .login-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #87CEEB 0%, #90EE90 100%);
            z-index: -2;
        }

        .animated-fields {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(139, 195, 74, 0.3) 2%, transparent 2.5%),
                radial-gradient(circle at 60% 40%, rgba(139, 195, 74, 0.3) 2%, transparent 2.5%),
                radial-gradient(circle at 80% 60%, rgba(139, 195, 74, 0.3) 2%, transparent 2.5%),
                radial-gradient(circle at 40% 70%, rgba(139, 195, 74, 0.3) 2%, transparent 2.5%),
                radial-gradient(circle at 30% 20%, rgba(139, 195, 74, 0.3) 2%, transparent 2.5%),
                linear-gradient(90deg, transparent 50%, rgba(255,255,255,0.1) 50%),
                linear-gradient(transparent 50%, rgba(255,255,255,0.1) 50%);
            background-size: 200px 200px, 200px 200px, 200px 200px, 200px 200px, 200px 200px, 50px 50px, 50px 50px;
            opacity: 0.7;
            z-index: -1;
            animation: fieldMove 20s linear infinite;
        }

        @keyframes fieldMove {
            0% { background-position: 0 0, 0 0, 0 0, 0 0, 0 0, 0 0, 0 0; }
            100% { background-position: 200px 200px, 200px 200px, 200px 200px, 200px 200px, 200px 200px, 50px 50px, 50px 50px; }
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-hover);
            width: 100%;
            max-width: 420px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            z-index: 1;
            border: 3px solid var(--primary-olive);
        }

        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .login-logo {
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 48px;
            color: var(--primary-olive);
            margin-bottom: 15px;
        }

        .login-logo h1 {
            font-size: 32px;
            color: var(--primary-olive);
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .login-logo p {
            color: var(--text-color);
            opacity: 0.7;
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-olive);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-olive);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 0 var(--secondary-olive);
        }

        .login-btn:hover {
            background-color: var(--secondary-olive);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--secondary-olive);
        }

        .login-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--secondary-olive);
        }

        .login-footer {
            margin-top: 25px;
            color: var(--text-color);
            opacity: 0.7;
            font-size: 14px;
        }

        /* NASA Badge */
        .nasa-badge {
            background: linear-gradient(135deg, #0b3d91, #fc3d21);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .nasa-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-left: 10px;
        }

        .nasa-status.active {
            background-color: rgba(46, 139, 87, 0.1);
            color: var(--primary-olive);
            border: 1px solid var(--primary-olive);
        }

        .nasa-status.inactive {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-olive);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-hover);
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            box-shadow: var(--shadow);
            transition: all var(--transition-speed) ease;
            z-index: 999;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-speed) ease;
        }

        .sidebar.collapsed .sidebar-header {
            justify-content: center;
            padding: 25px 10px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-icon {
            color: var(--primary-beige);
            font-size: 28px;
            transition: all var(--transition-speed) ease;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-beige);
            transition: all var(--transition-speed) ease;
        }

        .logo-text span {
            color: var(--aqua-blue);
        }

        .sidebar.collapsed .logo-text {
            opacity: 0;
            width: 0;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-item {
            margin-bottom: 5px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            text-decoration: none;
            color: var(--primary-beige);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--aqua-blue);
        }

        .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: var(--primary-beige);
            color: white;
        }

        .sidebar-icon {
            font-size: 20px;
            margin-right: 15px;
            min-width: 24px;
            text-align: center;
            transition: all var(--transition-speed) ease;
        }

        .sidebar.collapsed .sidebar-icon {
            margin-right: 0;
        }

        .sidebar-text {
            font-weight: 500;
            transition: all var(--transition-speed) ease;
        }

        .sidebar.collapsed .sidebar-text {
            opacity: 0;
            width: 0;
        }

        .toggle-sidebar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: var(--primary-beige);
            color: var(--primary-olive);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-sidebar:hover {
            background: var(--aqua-blue);
            transform: scale(1.05);
        }

        .sidebar.collapsed .toggle-sidebar {
            left: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left var(--transition-speed) ease;
            min-height: 100vh;
            background-color: var(--bg-color);
        }

        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }

        /* Header Styles */
        header {
            background-color: var(--header-bg);
            box-shadow: var(--shadow);
            padding: 20px 0;
            transition: background-color 0.3s ease;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .page-title {
            font-size: 28px;
            color: var(--primary-olive);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            color: var(--text-color);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-olive);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Main Content */
        main {
            padding: 30px 20px;
            min-height: calc(100vh - 160px);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Styles */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 32px;
            color: var(--primary-olive);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-subtitle {
            color: var(--text-color);
            font-size: 18px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            border-top: 5px solid var(--primary-olive);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-olive), var(--aqua-blue));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card.soil {
            border-top-color: var(--primary-brown);
        }

        .stat-card.water {
            border-top-color: var(--aqua-blue);
        }

        .stat-card.air {
            border-top-color: var(--primary-olive);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--white);
        }

        .soil-icon {
            background-color: var(--primary-brown);
        }

        .water-icon {
            background-color: var(--aqua-blue);
        }

        .air-icon {
            background-color: var(--primary-olive);
        }

        .stat-info h3 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-info p {
            color: #777;
            font-size: 14px;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-olive), var(--aqua-blue));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .map-container {
            background-color: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            transition: background-color 0.3s ease;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .map-title {
            font-size: 20px;
            color: var(--primary-olive);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .map-controls {
            display: flex;
            gap: 10px;
        }

        .map-btn {
            padding: 10px 15px;
            background-color: var(--light-gray);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-color);
            font-weight: 500;
        }

        .map-btn:hover {
            background-color: var(--border-color);
            transform: translateY(-2px);
        }

        .map-content {
            height: 500px;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .location-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 300px;
            z-index: 10;
            transition: background-color 0.3s ease;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .location-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--primary-olive);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .location-data {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .location-label {
            color: #777;
        }

        .location-value {
            font-weight: 500;
            color: var(--text-color);
        }

        .more-info-btn {
            width: 100%;
            margin-top: 15px;
            background-color: var(--primary-olive);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .more-info-btn:hover {
            background-color: var(--secondary-olive);
            transform: translateY(-2px);
        }

        /* Analysis Page */
        .analysis-container {
            padding: 0;
        }

        .analysis-header {
            margin-bottom: 30px;
        }

        .analysis-title {
            font-size: 28px;
            color: var(--primary-olive);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-subtitle {
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .analysis-location {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-olive);
            font-weight: 500;
        }

        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-color);
        }

        .tab-btn.active {
            color: var(--primary-olive);
            border-bottom: 3px solid var(--primary-olive);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .analysis-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            transition: background-color 0.3s ease;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            color: var(--primary-olive);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-good {
            background-color: rgba(46, 139, 87, 0.1);
            color: var(--primary-olive);
        }

        .status-moderate {
            background-color: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }

        .status-poor {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            background-color: var(--light-gray);
            transition: background-color 0.3s ease, transform 0.2s;
        }

        .metric:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .soil .metric-value {
            color: var(--primary-brown);
        }

        .water .metric-value {
            color: var(--aqua-blue);
        }

        .air .metric-value {
            color: var(--primary-olive);
        }

        .metric-label {
            font-size: 14px;
            color: #777;
        }

        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* CropLens AI Assistant Page */
        .crop-lens-container {
            padding: 0;
        }

        .crop-lens-header {
            margin-bottom: 30px;
        }

        .crop-lens-title {
            font-size: 28px;
            color: var(--primary-olive);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .crop-lens-subtitle {
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .ai-assistant-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            transition: background-color 0.3s ease;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ai-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-olive), var(--aqua-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .ai-title {
            font-size: 24px;
            color: var(--primary-olive);
        }

        .ai-description {
            color: var(--text-color);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .chat-container {
            background-color: var(--light-gray);
            border-radius: 12px;
            padding: 20px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }

        .message {
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            background-color: var(--primary-olive);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            background-color: var(--card-bg);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 12px 15px;
            background-color: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 15px;
            max-width: 80%;
            border-bottom-left-radius: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary-olive);
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
        }

        .send-btn {
            padding: 12px 20px;
            background-color: var(--primary-olive);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .send-btn:hover {
            background-color: var(--secondary-olive);
        }

        .send-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }

        .placeholder-text {
            text-align: center;
            color: #777;
            padding: 40px;
            font-style: italic;
        }

        /* Recommendations Page */
        .recommendations-container {
            padding: 0;
        }

        .recommendations-header {
            margin-bottom: 30px;
        }

        .recommendations-title {
            font-size: 28px;
            color: var(--primary-olive);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendations-subtitle {
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .carousel-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .carousel {
            display: flex;
            transition: transform 0.5s ease;
        }

        .carousel-item {
            min-width: 100%;
            padding: 40px;
            background-color: var(--card-bg);
            text-align: center;
        }

        .crop-emoji {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .crop-name {
            font-size: 24px;
            color: var(--primary-olive);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .crop-description {
            color: var(--text-color);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .nasa-data {
            background: rgba(11, 61, 145, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
        }

        .nasa-data h4 {
            color: #0b3d91;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nasa-data ul {
            list-style: none;
            padding-left: 0;
        }

        .nasa-data li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(11, 61, 145, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nasa-data li:before {
            content: "🛰️";
            font-size: 14px;
        }

        .carousel-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .carousel-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--border-color);
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .carousel-btn.active {
            background-color: var(--primary-olive);
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-olive);
            transition: all 0.3s;
        }

        .carousel-nav:hover {
            background-color: var(--primary-olive);
            color: white;
        }

        .carousel-prev {
            left: 10px;
        }

        .carousel-next {
            right: 10px;
        }

        /* Footer */
        footer {
            background-color: var(--footer-bg);
            padding: 40px 20px 20px;
            margin-top: 50px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s ease;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--primary-olive);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a {
            text-decoration: none;
            color: var(--text-color);
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--primary-olive);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            transition: all 0.3s;
        }

        .social-link:hover {
            background-color: var(--primary-olive);
            color: var(--white);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: #777;
            font-size: 14px;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            background-color: var(--primary-olive);
            color: white;
            border-radius: 5px;
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background-color: #e74c3c;
        }

        /* Game-like Elements */
        .level-badge {
            display: inline-block;
            padding: 4px 10px;
            background-color: var(--primary-olive);
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Satellite Toggle */
        .satellite-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-olive);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Data Accuracy Indicators */
        .accuracy-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .accuracy-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .accuracy-high {
            background-color: #2E8B57;
        }

        .accuracy-medium {
            background-color: #f39c12;
        }

        .accuracy-low {
            background-color: #e74c3c;
        }

        /* Enhanced Chart Containers */
        .chart-wrapper {
            position: relative;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 18px;
            color: var(--primary-olive);
            font-weight: 600;
        }

        .chart-legend {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }

            .sidebar-header {
                justify-content: center;
                padding: 20px 10px;
            }

            .logo-text {
                opacity: 0;
                width: 0;
            }

            .sidebar-text {
                opacity: 0;
                width: 0;
            }

            .sidebar-icon {
                margin-right: 0;
            }

            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }

            .header-container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .map-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .location-info {
                position: relative;
                bottom: auto;
                left: auto;
                width: 100%;
                margin-top: 20px;
            }

            .theme-toggle {
                top: 80px;
                right: 10px;
            }

            .theme-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .carousel-nav {
                display: none;
            }

            .analysis-tabs {
                flex-direction: column;
            }

            .tab-btn {
                text-align: left;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar, .theme-toggle, .map-controls, .carousel-nav {
                display: none !important;
            }

            .main-content {
                margin-left: 0 !important;
            }

            .login-container {
                display: none !important;
            }

            #app {
                display: block !important;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --primary-olive: #006400;
                --secondary-olive: #008000;
                --primary-brown: #5D4037;
                --aqua-blue: #008080;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* =================================================
           COMPREHENSIVE TEXT CONTRAST FIXES
           Fixing all readability issues without breaking existing styles
           ================================================= */

        /* 1. NASA Data Insights - Fix black text on dark blue background */
        .nasa-data,
        .nasa-data ul,
        .nasa-data li {
            color: var(--white) !important;
        }

        .nasa-data h4 {
            color: var(--white) !important;
        }

        /* 2. Dark card backgrounds - ensure white text */
        .stat-card,
        .analysis-card,
        .ai-assistant-card {
            background-color: var(--card-bg);
        }

        .stat-card.soil,
        .stat-card.water, 
        .stat-card.air,
        .stat-card[data-tab="soil"],
        .stat-card[data-tab="water"],
        .stat-card[data-tab="air"] {
            background-color: var(--card-bg) !important;
        }

        /* 3. Status text and descriptions on dark backgrounds */
        .analysis-subtitle,
        .crop-lens-subtitle,
        .recommendations-subtitle,
        .dashboard-subtitle {
            color: var(--secondary-text) !important;
        }

        /* 4. Carousel and recommendation text fixes */
        .carousel-item {
            background-color: var(--card-bg) !important;
        }

        .crop-description {
            color: var(--secondary-text) !important;
        }

        /* 5. Map controls and button text */
        .map-btn {
            color: var(--secondary-text) !important;
            background-color: var(--light-gray) !important;
        }

        .map-btn:hover {
            background-color: var(--primary-olive) !important;
            color: var(--white) !important;
        }

        /* 6. Location info text */
        .location-info .location-value,
        .location-info .location-label {
            color: var(--secondary-text) !important;
        }

        .location-title {
            color: var(--primary-olive) !important;
        }

        /* 7. Chart and metric labels */
        .metric-label,
        .metric-value {
            color: var(--secondary-text) !important;
        }

        /* 8. Tab buttons and navigation */
        .tab-btn {
            color: var(--secondary-text) !important;
        }

        .tab-btn.active,
        .tab-btn:hover {
            color: var(--primary-olive) !important;
        }

        /* 9. Chat and AI assistant text */
        .chat-input {
            color: var(--secondary-text) !important;
            background-color: var(--card-bg) !important;
        }

        .ai-message {
            color: var(--secondary-text) !important;
            background-color: var(--card-bg) !important;
        }

        .placeholder-text {
            color: var(--secondary-text) !important;
        }

        /* 10. Form controls and inputs */
        .form-control {
            color: var(--secondary-text) !important;
            background-color: var(--card-bg) !important;
        }

        .form-group label {
            color: var(--secondary-text) !important;
        }

        /* 11. Footer and links */
        .footer-links li {
            color: var(--secondary-text) !important;
        }

        .footer-column h3 {
            color: var(--primary-olive) !important;
        }

        /* 12. Page titles and headers - ensure proper contrast */
        .page-title,
        .analysis-title,
        .recommendations-title,
        .crop-lens-title,
        .dashboard-title,
        .map-title,
        .card-title {
            color: var(--primary-olive) !important;
        }

        /* 13. Status badges and indicators */
        .card-status {
            background-color: rgba(46, 139, 87, 0.1) !important;
            color: var(--primary-olive) !important;
        }

        /* 14. Toggle labels and controls */
        .satellite-toggle span {
            color: var(--secondary-text) !important;
        }

        /* 15. User info in header */
        .user-info span {
            color: var(--secondary-text) !important;
        }

        /* 16. Ensure proper contrast for dark theme */
        [data-theme="dark"] .analysis-subtitle,
        [data-theme="dark"] .crop-lens-subtitle,
        [data-theme="dark"] .recommendations-subtitle,
        [data-theme="dark"] .dashboard-subtitle,
        [data-theme="dark"] .location-value,
        [data-theme="dark"] .location-label,
        [data-theme="dark"] .metric-label,
        [data-theme="dark"] .crop-description,
        [data-theme="dark"] .placeholder-text,
        [data-theme="dark"] .footer-links li {
            color: var(--text-color) !important;
        }

        /* 17. Special fixes for specific problem areas seen in screenshots */

        /* NASA Data Insights section - the blue box with bullet points */
        .nasa-data {
            background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%) !important;
            color: white !important;
        }

        .nasa-data ul li {
            color: white !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* Crop recommendation carousel text */
        .carousel-item p,
        .carousel-item .crop-description {
            color: #374151 !important; /* Dark gray for light background */
        }

        /* AI Assistant description text */
        .ai-description {
            color: var(--secondary-text) !important;
        }

        /* Chat message in AI assistant */
        .message.ai-message {
            color: #374151 !important;
            background-color: white !important;
        }

        /* Input placeholder text */
        .chat-input::placeholder {
            color: #9ca3af !important;
        }

        /* Ensure all text in main content area is readable */
        main p,
        main span:not(.nasa-badge):not(.level-badge) {
            color: var(--secondary-text) !important;
        }
        


        /* =================================================
           TARGETED TEXT COLOR FIXES - SPECIFIC CLASSES
           Creating separate classes to avoid color conflicts
           ================================================= */

        /* 1. AI Assistant Page - Specific Classes */
        .ai-description-text {
            color: #374151 !important; /* Dark gray for light backgrounds */
        }

        [data-theme="dark"] .ai-description-text {
            color: #e5e7eb !important; /* Light gray for dark backgrounds */
        }

        /* 2. Crop Recommendation Cards - Specific Classes */
        .crop-description-text {
            color: #374151 !important; /* Dark text for carousel light backgrounds */
            line-height: 1.6;
        }

        [data-theme="dark"] .crop-description-text {
            color: #d1d5db !important; /* Light gray for dark theme */
        }

        /* 3. Analysis Metrics - Specific Classes */
        .metric-value-text {
            color: #1f2937 !important; /* Dark text for metric values */
            font-weight: 600;
        }

        .metric-label-text {
            color: #6b7280 !important; /* Medium gray for metric labels */
        }

        [data-theme="dark"] .metric-value-text {
            color: #f9fafb !important; /* White text for dark theme */
        }

        [data-theme="dark"] .metric-label-text {
            color: #d1d5db !important; /* Light gray for dark theme */
        }

        /* 4. NASA Data Insights - Specific Classes */
        .nasa-insights-text {
            color: #ffffff !important; /* White text for blue background */
        }

        .nasa-insights-list {
            color: #ffffff !important; /* White text for list items */
        }

        /* 5. Chat Messages - Specific Classes */
        .ai-chat-message {
            color: #374151 !important; /* Dark text for light chat bubbles */
            background-color: #ffffff !important;
        }

        [data-theme="dark"] .ai-chat-message {
            color: #e5e7eb !important; /* Light text for dark theme */
            background-color: #374151 !important;
        }

        /* 6. Form Labels - Specific Classes */
        .form-label-text {
            color: #374151 !important; /* Dark text for form labels */
        }

        [data-theme="dark"] .form-label-text {
            color: #d1d5db !important; /* Light text for dark theme */
        }

        /* 7. Location Info - Specific Classes */
        .location-info-label {
            color: #6b7280 !important; /* Medium gray for labels */
        }

        .location-info-value {
            color: #1f2937 !important; /* Dark text for values */
        }

        [data-theme="dark"] .location-info-label {
            color: #9ca3af !important;
        }

        [data-theme="dark"] .location-info-value {
            color: #f3f4f6 !important;
        }

        /* 8. Card Status - Specific Classes */
        .card-status-text {
            color: #059669 !important; /* Green for status text */
            background-color: rgba(16, 185, 129, 0.1) !important;
        }

        /* 9. Page Subtitles - Specific Classes */
        .page-subtitle-text {
            color: #6b7280 !important; /* Medium gray for subtitles */
        }

        [data-theme="dark"] .page-subtitle-text {
            color: #9ca3af !important;
        }

        /* 10. Button Text - Specific Classes */
        .map-control-btn {
            color: #374151 !important;
            background-color: #f3f4f6 !important;
        }

        .map-control-btn:hover {
            color: #ffffff !important;
            background-color: #059669 !important;
        }

        [data-theme="dark"] .map-control-btn {
            color: #d1d5db !important;
            background-color: #4b5563 !important;
        }

        /* 11. Override any conflicting styles for specific elements */
        .text-override-dark {
            color: #1f2937 !important;
        }

        .text-override-light {
            color: #f9fafb !important;
        }

        .text-override-gray {
            color: #6b7280 !important;
        }

        [data-theme="dark"] .text-override-dark {
            color: #f9fafb !important;
        }

        [data-theme="dark"] .text-override-gray {
            color: #9ca3af !important;
        }

    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-background"></div>
        <div class="animated-fields"></div>
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-seedling"></i>
                <h1 class="text-3xl font-bold text-green-600">Soil<span class="text-blue-500">Scope</span></h1>
                <p class="text-gray-600 dark:text-gray-300">NASA-Powered Agricultural Intelligence</p>
                <div class="nasa-status active">
                    <i class="fas fa-satellite"></i> NASA API Connected
                </div>
            </div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn">Sign In</button>
            </form>
            <div class="login-footer">
                <p>Don't have an account? <a href="#" class="text-green-600 hover:text-green-800 transition-colors">Contact Administrator</a></p>
            </div>
        </div>
    </div>

    <!-- Main Application (Initially Hidden) -->
    <div id="app" style="display: none;">
        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>

        <!-- Theme Toggle -->
        <div class="theme-toggle">
            <button id="theme-btn" class="theme-btn">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <i class="fas fa-seedling logo-icon"></i>
                    <div class="logo-text">Soil<span>Scope</span></div>
                </a>
            </div>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt sidebar-icon"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" data-page="analysis">
                        <i class="fas fa-chart-bar sidebar-icon"></i>
                        <span class="sidebar-text">Analysis</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" data-page="recommendations">
                        <i class="fas fa-leaf sidebar-icon"></i>
                        <span class="sidebar-text">Recommendations</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link" data-page="crop-lens">
                        <i class="fas fa-robot sidebar-icon"></i>
                        <span class="sidebar-text">CropLens AI</span>
                    </a>
                </li>
            </ul>
            <button class="toggle-sidebar" id="toggle-sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-md transition-colors duration-300">
                <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                    <h1 class="page-title text-2xl font-bold text-green-600 flex items-center gap-2">
                        Dashboard
                        <span class="nasa-badge">
                            <i class="fas fa-satellite"></i> NASA POWERED
                        </span>
                    </h1>
                    <div class="user-info flex items-center gap-3">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <span id="user-name" class="text-gray-700 dark:text-gray-300">User</span>
                        <span class="level-badge">Level 5</span>
                        <div class="nasa-status active" id="nasa-status">
                            <i class="fas fa-satellite"></i> NASA ONLINE
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="p-6">
                <!-- Dashboard Page -->
                <section id="dashboard" class="page active">
                    <div class="container mx-auto">
                        <div class="dashboard-header mb-8">
                            <h1 class="dashboard-title text-3xl font-bold text-green-600 flex items-center gap-2">
                                Farm Analysis Dashboard
                                <span class="nasa-badge">NASA SATELLITE DATA</span>
                            </h1>
                            <p class="dashboard-subtitle text-gray-600 dark:text-gray-300">Monitor your soil, water, and air conditions with real-time NASA satellite data</p>
                        </div>
                        
                        <div class="stats-cards grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="stat-card soil bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 flex items-center gap-4 transition-all duration-300 hover:shadow-lg cursor-pointer" data-tab="soil">
                                <div class="stat-icon soil-icon w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl">
                                    <i class="fas fa-mountain"></i>
                                </div>
                                <div class="stat-info flex-1">
                                    <h3 class="text-xl font-bold flex items-center gap-2">Soil Health <span class="nasa-badge">NASA</span></h3>
                                    <p class="text-gray-500 dark:text-gray-400">Optimal Conditions</p>
                                    <div class="progress-bar bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden mt-2">
                                        <div class="progress-fill h-full bg-gradient-to-r from-green-600 to-teal-400" style="width: 92%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card water bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 flex items-center gap-4 transition-all duration-300 hover:shadow-lg cursor-pointer" data-tab="water">
                                <div class="stat-icon water-icon w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="stat-info flex-1">
                                    <h3 class="text-xl font-bold flex items-center gap-2">Water Quality <span class="nasa-badge">NASA</span></h3>
                                    <p class="text-gray-500 dark:text-gray-400">Good Level</p>
                                    <div class="progress-bar bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden mt-2">
                                        <div class="progress-fill h-full bg-gradient-to-r from-green-600 to-teal-400" style="width: 78%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card air bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 flex items-center gap-4 transition-all duration-300 hover:shadow-lg cursor-pointer" data-tab="air">
                                <div class="stat-icon air-icon w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="stat-info flex-1">
                                    <h3 class="text-xl font-bold flex items-center gap-2">Air Quality <span class="nasa-badge">NASA</span></h3>
                                    <p class="text-gray-500 dark:text-gray-400">Excellent</p>
                                    <div class="progress-bar bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden mt-2">
                                        <div class="progress-fill h-full bg-gradient-to-r from-green-600 to-teal-400" style="width: 95%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="map-container bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden mb-8">
                            <div class="map-header p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <h2 class="map-title text-xl font-bold text-green-600 flex items-center gap-2">
                                    Farm Location & Analysis 
                                    <span class="nasa-badge">LIVE SATELLITE</span>
                                </h2>
                                <div class="map-controls flex flex-wrap gap-2">
                                    <button class="map-btn map-control-btn px-4 py-2 rounded-lg flex items-center gap-2 transition-colors" id="search-location">
                                        <i class="fas fa-search-location"></i> Search
                                    </button>
                                    <button class="map-btn map-control-btn px-4 py-2 rounded-lg flex items-center gap-2 transition-colors" id="get-current-location">
                                        <i class="fas fa-location-arrow"></i> My Location
                                    </button>
                                    <button class="map-btn map-control-btn px-4 py-2 rounded-lg flex items-center gap-2 transition-colors" id="fetch-nasa-data">
                                        <i class="fas fa-satellite"></i> Fetch NASA Data
                                    </button>
                                    <button class="map-btn map-control-btn px-4 py-2 rounded-lg flex items-center gap-2 transition-colors" id="save-location">
                                        <i class="fas fa-save"></i> Save Location
                                    </button>
                                </div>
                            </div>
                            <div class="satellite-toggle flex items-center gap-4 p-4 border-b border-gray-200 dark:border-gray-700">
                                <span class="text-gray-700 dark:text-gray-300">Satellite View:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="satellite-toggle">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="text-gray-700 dark:text-gray-300">NASA Data Overlay:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="nasa-overlay-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="map-content h-96 md:h-[500px] relative">
                                <div id="map" class="w-full h-full"></div>
                                <div class="location-info absolute bottom-4 left-4 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md w-full md:w-80 z-10">
                                    <h4 class="location-title text-lg font-bold text-green-600 flex items-center gap-2 mb-4">
                                        <i class="fas fa-map-marker-alt"></i> Current Location
                                        <span class="nasa-badge">LIVE</span>
                                    </h4>
                                    <div class="location-data flex justify-between mb-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                        <span class="location-label location-info-label">Latitude:</span>
                                        <span class="location-value location-info-value font-medium" id="latitude">Loading...</span>
                                    </div>
                                    <div class="location-data flex justify-between mb-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                        <span class="location-label location-info-label">Longitude:</span>
                                        <span class="location-value location-info-value font-medium" id="longitude">Loading...</span>
                                    </div>
                                    <div class="location-data flex justify-between mb-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                        <span class="location-label location-info-label">Address:</span>
                                        <span class="location-value location-info-value font-medium" id="address">Loading...</span>
                                    </div>
                                    <div class="location-data flex justify-between mb-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                        <span class="location-label location-info-label">NDVI Index:</span>
                                        <span class="location-value location-info-value font-medium" id="ndvi-value">0.72</span>
                                    </div>
                                    <div class="location-data flex justify-between mb-2 pb-2 border-b border-gray-200 dark:border-gray-700">
                                        <span class="location-label location-info-label">Soil Moisture:</span>
                                        <span class="location-value location-info-value font-medium" id="soil-moisture">38%</span>
                                    </div>
                                    <button class="more-info-btn bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg flex items-center justify-center gap-2 transition-all duration-300 mt-4 w-full" id="more-info-btn">
                                        <i class="fas fa-chart-bar"></i> Detailed Analysis
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analysis Page -->
                <section id="analysis" class="page">
                    <div class="container mx-auto">
                        <div class="analysis-header mb-8">
                            <h1 class="analysis-title text-3xl font-bold text-green-600 flex items-center gap-2">
                                Detailed Analysis 
                                <span class="nasa-badge">NASA DATA</span>
                            </h1>
                            <p class="analysis-subtitle page-subtitle-text">Comprehensive breakdown of soil, water, and air conditions using NASA satellite data</p>
                            <div class="analysis-location flex items-center gap-2 text-green-600 font-medium mt-2">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="analysis-location-text">Analyzing data for your selected location</span>
                            </div>
                        </div>
                        
                        <div class="analysis-tabs flex flex-wrap gap-4 mb-8 border-b border-gray-200 dark:border-gray-700">
                            <button class="tab-btn px-6 py-3 border-b-2 border-transparent font-medium transition-all duration-300 text-gray-600 dark:text-gray-300 hover:text-green-600 active:border-green-600 active:text-green-600" data-tab="soil">Soil Analysis</button>
                            <button class="tab-btn px-6 py-3 border-b-2 border-transparent font-medium transition-all duration-300 text-gray-600 dark:text-gray-300 hover:text-green-600" data-tab="water">Water Analysis</button>
                            <button class="tab-btn px-6 py-3 border-b-2 border-transparent font-medium transition-all duration-300 text-gray-600 dark:text-gray-300 hover:text-green-600" data-tab="air">Air Analysis</button>
                            <button class="tab-btn px-6 py-3 border-b-2 border-transparent font-medium transition-all duration-300 text-gray-600 dark:text-gray-300 hover:text-green-600" data-tab="satellite">Satellite Data</button>
                        </div>
                        
                        <!-- Soil Analysis Tab -->
                        <div id="soil-tab" class="tab-content active">
                            <div class="analysis-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                                <div class="card-header flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-5">
                                    <h2 class="card-title text-xl font-bold text-green-600 flex items-center gap-2">
                                        Soil Health Overview 
                                        <span class="nasa-badge">NASA SMAP</span>
                                    </h2>
                                    <div class="card-status bg-green-100 text-green-800 px-4 py-1 rounded-full text-sm font-medium">Optimal</div>
                                </div>
                                <div class="metrics-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">6.5 pH</div>
                                        <div class="metric-label metric-label-text">Acidity Level</div>
                                    </div>
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">38%</div>
                                        <div class="metric-label metric-label-text">Moisture Content</div>
                                    </div>
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">4.2%</div>
                                        <div class="metric-label metric-label-text">Organic Matter</div>
                                    </div>
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">High</div>
                                        <div class="metric-label metric-label-text">Nutrient Level</div>
                                    </div>
                                </div>
                                <div class="chart-container h-72">
                                    <canvas id="soilPieChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Water Analysis Tab -->
                        <div id="water-tab" class="tab-content">
                            <div class="analysis-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                                <div class="card-header flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-5">
                                    <h2 class="card-title text-xl font-bold text-green-600 flex items-center gap-2">
                                        Water Quality Overview 
                                        <span class="nasa-badge">NASA GRACE</span>
                                    </h2>
                                    <div class="card-status bg-green-100 text-green-800 px-4 py-1 rounded-full text-sm font-medium">Good</div>
                                </div>
                                <div class="metrics-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                    <div class="metric water bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-teal-500">7.1 pH</div>
                                        <div class="metric-label metric-label-text">Water Acidity</div>
                                    </div>
                                    <div class="metric water bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-teal-500">85 ppm</div>
                                        <div class="metric-label metric-label-text">Total Dissolved Solids</div>
                                    </div>
                                    <div class="metric water bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-teal-500">0.5 mg/L</div>
                                        <div class="metric-label metric-label-text">Nitrate Level</div>
                                    </div>
                                    <div class="metric water bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-teal-500">Excellent</div>
                                        <div class="metric-label metric-label-text">Bacterial Quality</div>
                                    </div>
                                </div>
                                <div class="chart-container h-72">
                                    <canvas id="waterBarChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Air Analysis Tab -->
                        <div id="air-tab" class="tab-content">
                            <div class="analysis-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                                <div class="card-header flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-5">
                                    <h2 class="card-title text-xl font-bold text-green-600 flex items-center gap-2">
                                        Air Quality Overview 
                                        <span class="nasa-badge">NASA MODIS</span>
                                    </h2>
                                    <div class="card-status bg-green-100 text-green-800 px-4 py-1 rounded-full text-sm font-medium">Excellent</div>
                                </div>
                                <div class="metrics-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                    <div class="metric air bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-green-600">15 AQI</div>
                                        <div class="metric-label metric-label-text">Air Quality Index</div>
                                    </div>
                                    <div class="metric air bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-green-600">415 ppm</div>
                                        <div class="metric-label metric-label-text">CO2 Level</div>
                                    </div>
                                    <div class="metric air bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-green-600">65%</div>
                                        <div class="metric-label metric-label-text">Humidity</div>
                                    </div>
                                    <div class="metric air bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-green-600">24°C</div>
                                        <div class="metric-label metric-label-text">Temperature</div>
                                    </div>
                                </div>
                                <div class="chart-container h-72">
                                    <canvas id="windChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Satellite Data Tab -->
                        <div id="satellite-tab" class="tab-content">
                            <div class="analysis-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                                <div class="card-header flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-5">
                                    <h2 class="card-title text-xl font-bold text-green-600 flex items-center gap-2">
                                        Satellite Data Analysis 
                                        <span class="nasa-badge">LIVE FEED</span>
                                    </h2>
                                    <div class="card-status bg-green-100 text-green-800 px-4 py-1 rounded-full text-sm font-medium">Active</div>
                                </div>
                                <div class="metrics-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">0.72</div>
                                        <div class="metric-label metric-label-text">NDVI Index</div>
                                    </div>
                                    <div class="metric water bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-teal-500">0.38</div>
                                        <div class="metric-label metric-label-text">Soil Moisture</div>
                                    </div>
                                    <div class="metric air bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-green-600">24°C</div>
                                        <div class="metric-label metric-label-text">Surface Temp</div>
                                    </div>
                                    <div class="metric soil bg-gray-100 dark:bg-gray-700 rounded-lg p-5 text-center transition-all duration-300 hover:-translate-y-1">
                                        <div class="metric-value metric-value-text text-2xl font-bold text-amber-800">88%</div>
                                        <div class="metric-label metric-label-text">Vegetation Health</div>
                                    </div>
                                </div>
                                <div class="chart-container h-72">
                                    <canvas id="satelliteChart"></canvas>
                                </div>
                                <div class="card-header mt-5">
                                    <h2 class="card-title text-xl font-bold text-green-600">NASA Satellite Insights</h2>
                                </div>
                                <div id="satellite-images" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                    <div class="bg-gradient-to-br from-green-600 to-amber-800 rounded-lg p-4 text-white text-center">
                                        <i class="fas fa-satellite text-2xl mb-2"></i>
                                        <div class="font-medium">NDVI Map</div>
                                        <small>Value: 0.72</small>
                                    </div>
                                    <div class="bg-gradient-to-br from-teal-500 to-blue-500 rounded-lg p-4 text-white text-center">
                                        <i class="fas fa-tint text-2xl mb-2"></i>
                                        <div class="font-medium">Soil Moisture</div>
                                        <small>38% Capacity</small>
                                    </div>
                                    <div class="bg-gradient-to-br from-orange-500 to-red-500 rounded-lg p-4 text-white text-center">
                                        <i class="fas fa-thermometer-half text-2xl mb-2"></i>
                                        <div class="font-medium">Surface Temp</div>
                                        <small>24.2°C</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recommendations Page -->
                <section id="recommendations" class="page">
                    <div class="container mx-auto">
                        <div class="recommendations-header mb-8">
                            <h1 class="recommendations-title text-3xl font-bold text-green-600 flex items-center gap-2">
                                Crop Recommendations 
                                <span class="nasa-badge">NASA ENHANCED</span>
                            </h1>
                            <p class="recommendations-subtitle page-subtitle-text">Best crops for your farm based on current conditions and NASA satellite data</p>
                        </div>
                        
                        <div class="carousel-container relative max-w-4xl mx-auto overflow-hidden rounded-xl shadow-md">
                            <div class="carousel flex transition-transform duration-500 ease-in-out" id="carousel">
                                <div class="carousel-item min-w-full p-8 md:p-10 bg-white dark:bg-gray-800 text-center">
                                    <div class="crop-emoji text-6xl mb-4">🌽</div>
                                    <h2 class="crop-name text-2xl font-bold text-green-600 flex items-center justify-center gap-2 mb-3">
                                        Corn 
                                        <span class="nasa-badge">94% MATCH</span>
                                    </h2>
                                    <p class="crop-description crop-description-text mb-5">Corn thrives in your soil's pH level and has moderate water requirements. NASA data shows optimal temperature range and sufficient soil moisture for high yield potential.</p>
                                    <div class="nasa-data bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mt-6 text-left">
                                        <h4 class="nasa-insights-text font-bold mb-3 flex items-center gap-2"><i class="fas fa-satellite"></i> NASA Data Insights:</h4>
                                        <ul class="space-y-2">
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Optimal temperature range: 18-27°C</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Soil moisture: 38% (within ideal range)</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">NDVI trend: Improving (0.68 → 0.72)</li>
                                            <li class="flex items-center gap-2 py-1">Solar radiation: Optimal for growth</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="carousel-item min-w-full p-8 md:p-10 bg-white dark:bg-gray-800 text-center">
                                    <div class="crop-emoji text-6xl mb-4">🌱</div>
                                    <h2 class="crop-name text-2xl font-bold text-green-600 flex items-center justify-center gap-2 mb-3">
                                        Soybeans 
                                        <span class="nasa-badge">89% MATCH</span>
                                    </h2>
                                    <p class="crop-description crop-description-text mb-5">Soybeans are excellent for nitrogen fixation in your soil type. NASA climate data indicates favorable growing conditions with adequate rainfall forecast.</p>
                                    <div class="nasa-data bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mt-6 text-left">
                                        <h4 class="nasa-insights-text font-bold mb-3 flex items-center gap-2"><i class="fas fa-satellite"></i> NASA Data Insights:</h4>
                                        <ul class="space-y-2">
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Rainfall forecast: 120mm next 30 days</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Soil temperature: Optimal at 15cm depth</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Pest risk: Low (based on thermal imaging)</li>
                                            <li class="flex items-center gap-2 py-1">Regional yield: +8% above average</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="carousel-item min-w-full p-8 md:p-10 bg-white dark:bg-gray-800 text-center">
                                    <div class="crop-emoji text-6xl mb-4">🌾</div>
                                    <h2 class="crop-name text-2xl font-bold text-green-600 flex items-center justify-center gap-2 mb-3">
                                        Wheat 
                                        <span class="nasa-badge">87% MATCH</span>
                                    </h2>
                                    <p class="crop-description crop-description-text mb-5">Wheat is optimal for the current season with your soil conditions. NASA satellite data shows consistent vegetation health in nearby wheat fields.</p>
                                    <div class="nasa-data bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mt-6 text-left">
                                        <h4 class="nasa-insights-text font-bold mb-3 flex items-center gap-2"><i class="fas fa-satellite"></i> NASA Data Insights:</h4>
                                        <ul class="space-y-2">
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Solar radiation: Optimal for grain filling</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Wind patterns: Favorable for pollination</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Regional yield: +12% above average</li>
                                            <li class="flex items-center gap-2 py-1">Disease risk: Low humidity levels</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="carousel-item min-w-full p-8 md:p-10 bg-white dark:bg-gray-800 text-center">
                                    <div class="crop-emoji text-6xl mb-4">🥔</div>
                                    <h2 class="crop-name text-2xl font-bold text-green-600 flex items-center justify-center gap-2 mb-3">
                                        Potatoes 
                                        <span class="nasa-badge">82% MATCH</span>
                                    </h2>
                                    <p class="crop-description crop-description-text mb-5">Potatoes grow well in your slightly acidic soil. NASA soil moisture data indicates good water retention capacity for consistent tuber development.</p>
                                    <div class="nasa-data bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mt-6 text-left">
                                        <h4 class="nasa-insights-text font-bold mb-3 flex items-center gap-2"><i class="fas fa-satellite"></i> NASA Data Insights:</h4>
                                        <ul class="space-y-2">
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Soil temperature: Ideal for tuber initiation</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Moisture retention: High in clay content</li>
                                            <li class="nasa-insights-list flex items-center gap-2 py-1 border-b border-blue-100 dark:border-blue-800">Disease risk: Low (based on humidity data)</li>
                                            <li class="flex items-center gap-2 py-1">Growing degree days: Optimal range</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <button class="carousel-nav carousel-prev absolute left-4 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-green-600 hover:text-white w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300" id="carousel-prev">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-nav carousel-next absolute right-4 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-green-600 hover:text-white w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300" id="carousel-next">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <div class="carousel-controls flex justify-center gap-2 mt-6" id="carousel-controls">
                                <button class="carousel-btn w-3 h-3 rounded-full bg-gray-300 transition-all duration-300 active:bg-green-600" data-index="0"></button>
                                <button class="carousel-btn w-3 h-3 rounded-full bg-gray-300 transition-all duration-300" data-index="1"></button>
                                <button class="carousel-btn w-3 h-3 rounded-full bg-gray-300 transition-all duration-300" data-index="2"></button>
                                <button class="carousel-btn w-3 h-3 rounded-full bg-gray-300 transition-all duration-300" data-index="3"></button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CropLens AI Assistant Page -->
                <section id="crop-lens" class="page">
                    <div class="container mx-auto">
                        <div class="crop-lens-header mb-8">
                            <h1 class="crop-lens-title text-3xl font-bold text-green-600 flex items-center gap-2">
                                CropLens AI Assistant 
                                <span class="nasa-badge">NASA POWERED</span>
                            </h1>
                            <p class="crop-lens-subtitle page-subtitle-text">Get AI-powered insights for your farming decisions enhanced with NASA satellite data</p>
                        </div>
                        
                        <div class="ai-assistant-card bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 md:p-8 mb-8">
                            <div class="ai-header flex flex-col md:flex-row items-start md:items-center gap-4 mb-6">
                                <div class="ai-icon w-16 h-16 rounded-full bg-gradient-to-br from-green-600 to-teal-400 flex items-center justify-center text-white text-2xl">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div>
                                    <h2 class="ai-title text-2xl font-bold text-green-600">CropLens AI</h2>
                                    <p class="ai-description ai-description-text">Ask questions about soil conditions, crop recommendations, pest control, and more. Our AI assistant uses real-time NASA satellite data for precise insights.</p>
                                </div>
                            </div>
                            
                            <div class="chat-container bg-gray-100 dark:bg-gray-700 rounded-xl p-5 h-96 flex flex-col">
                                <div class="chat-messages flex-1 overflow-y-auto mb-5 pr-2" id="chat-messages">
                                    <div class="message ai-message bg-white dark:bg-gray-800 p-3 rounded-xl mb-4 max-w-[80%]">
                                        Hello! I'm CropLens AI, your agricultural assistant powered by NASA satellite data. I can help you with soil analysis, crop recommendations, pest control, and more using real-time satellite insights. How can I assist you today?
                                    </div>
                                    <div class="placeholder-text text-center text-gray-500 p-8 italic" id="placeholder-text">
                                        Start a conversation with CropLens AI by typing a message below.
                                    </div>
                                </div>
                                <div class="chat-input-container flex gap-3">
                                    <input type="text" class="chat-input flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200" id="chat-input" placeholder="Ask a question about farming...">
                                    <button class="send-btn bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-lg flex items-center gap-2 transition-colors" id="send-btn">
                                        <i class="fas fa-paper-plane"></i> Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Footer -->
            <footer class="bg-white dark:bg-gray-800 py-10 px-6 mt-12 shadow-inner">
                <div class="container mx-auto">
                    <div class="footer-content grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                        <div class="footer-column">
                            <h3 class="text-lg font-bold text-green-600 mb-5">Contact Us</h3>
                            <ul class="footer-links space-y-3">
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-map-marker-alt text-green-600"></i>Nagala, Zirakpur, Punjab, India</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-phone text-green-600"></i> +91 62841 59714</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-envelope text-green-600"></i> araadh3111@gmail.com</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-clock text-green-600"></i> Mon-Fri: 9AM-5PM</li>
                            </ul>
                            <div class="social-links flex gap-4 mt-5">
                                <a href="#" class="social-link w-10 h-10 rounded-full bg-gray-100 dark:bg-g ray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 transition-all hover:bg-green-600 hover:text-white hover:-translate-y-1"><i class="fab fa-facebook-f"></i></a>
                                <a href="#" class="social-link w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 transition-all hover:bg-green-600 hover:text-white hover:-translate-y-1"><i class="fab fa-twitter"></i></a>
                                <a href="#" class="social-link w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 transition-all hover:bg-green-600 hover:text-white hover:-translate-y-1"><i class="fab fa-instagram"></i></a>
                                <a href="#" class="social-link w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 transition-all hover:bg-green-600 hover:text-white hover:-translate-y-1"><i class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>
                        <div class="footer-column">
                            <h3 class="text-lg font-bold text-green-600 mb-5">NASA Data Sources</h3>
                            <ul class="footer-links space-y-3">
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-satellite text-green-600"></i> NASA POWER API</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-satellite text-green-600"></i> Landsat Satellite Data</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-satellite text-green-600"></i> SMAP Soil Moisture</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-satellite text-green-600"></i> MODIS Vegetation</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-satellite text-green-600"></i> GRACE Water Data</li>
                            </ul>
                        </div>
                        <div class="footer-column">
                            <h3 class="text-lg font-bold text-green-600 mb-5">Quick Links</h3>
                            <ul class="footer-links space-y-3">
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-seedling text-green-600"></i> Crop Database</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-book text-green-600"></i> Farming Guides</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-chart-line text-green-600"></i> Market Trends</li>
                                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-300"><i class="fas fa-question-circle text-green-600"></i> Support</li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-bottom text-center pt-8 border-t border-gray-200 dark:border-gray-700 text-gray-500 text-sm">
                        <p>&copy; 2023 Soil Scope. All rights reserved. | Powered by NASA Open APIs and Satellite Data</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        // Real agricultural data for major farming regions
        const agriculturalData = {
            // Major US agricultural regions with real coordinates
            regions: {
                'California Central Valley': { 
                    lat: 36.7378, 
                    lng: -119.7871,
                    soil: { type: 'Sandy Loam', ph: 6.8, organicMatter: 3.2, moisture: 42 },
                    water: { quality: 'Good', ph: 7.2, tds: 150, nitrates: 0.6 },
                    air: { aqi: 12, co2: 410, humidity: 45, temperature: 28 },
                    crops: ['Almonds', 'Grapes', 'Tomatoes', 'Cotton'],
                    ndvi: 0.75
                },
                'Midwest Corn Belt': { 
                    lat: 40.7128, 
                    lng: -89.3377,
                    soil: { type: 'Silty Clay Loam', ph: 6.5, organicMatter: 4.2, moisture: 38 },
                    water: { quality: 'Excellent', ph: 7.1, tds: 85, nitrates: 0.5 },
                    air: { aqi: 15, co2: 415, humidity: 65, temperature: 24 },
                    crops: ['Corn', 'Soybeans', 'Wheat'],
                    ndvi: 0.72
                },
                'Texas High Plains': { 
                    lat: 34.9657, 
                    lng: -101.8969,
                    soil: { type: 'Clay Loam', ph: 7.1, organicMatter: 2.8, moisture: 35 },
                    water: { quality: 'Moderate', ph: 7.5, tds: 280, nitrates: 0.9 },
                    air: { aqi: 25, co2: 420, humidity: 35, temperature: 32 },
                    crops: ['Cotton', 'Wheat', 'Sorghum'],
                    ndvi: 0.68
                }
            }
        };

        // Enhanced NASA API with real data integration
        class EnhancedNasaAPI {
            constructor() {
                this.baseUrl = 'https://power.larc.nasa.gov/api/temporal/daily/point';
            }

            async getRealClimateData(lat, lon) {
                try {
                    // For demo purposes, we'll use realistic data based on location
                    // In production, this would make actual API calls
                    const region = this.findClosestRegion(lat, lon);
                    const baseData = agriculturalData.regions[region];
                    
                    // Add realistic variations based on coordinates
                    const variation = (Math.sin(lat * 100) + Math.cos(lon * 100)) * 0.1;
                    
                    return {
                        temperature: baseData.air.temperature + variation * 5,
                        precipitation: 650 + variation * 200, // mm/year
                        windSpeed: 3.5 + variation * 2,
                        humidity: baseData.air.humidity + variation * 10,
                        solarRadiation: 18.5 + variation * 3,
                        source: 'NASA POWER Enhanced',
                        region: region
                    };
                } catch (error) {
                    console.error('Error fetching climate data:', error);
                    return this.getFallbackClimateData();
                }
            }

            findClosestRegion(lat, lon) {
                let closestRegion = 'Midwest Corn Belt';
                let minDistance = Infinity;

                for (const [region, data] of Object.entries(agriculturalData.regions)) {
                    const distance = Math.sqrt(
                        Math.pow(lat - data.lat, 2) + Math.pow(lon - data.lng, 2)
                    );
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestRegion = region;
                    }
                }
                return closestRegion;
            }

            async getRealNDVIData(lat, lon) {
                const region = this.findClosestRegion(lat, lon);
                const baseNDVI = agriculturalData.regions[region].ndvi;
                
                // Seasonal variation simulation
                const now = new Date();
                const dayOfYear = (now.getMonth() * 30 + now.getDate()) / 365;
                const seasonalVariation = Math.sin(dayOfYear * 2 * Math.PI) * 0.1;
                
                return {
                    ndvi: Math.max(0.3, Math.min(0.9, baseNDVI + seasonalVariation)),
                    vegetationHealth: this.getHealthFromNDVI(baseNDVI + seasonalVariation),
                    trend: seasonalVariation > 0 ? 'Improving' : 'Declining',
                    lastUpdate: new Date().toISOString().split('T')[0]
                };
            }

            getHealthFromNDVI(ndvi) {
                if (ndvi > 0.7) return 'Excellent';
                if (ndvi > 0.5) return 'Good';
                if (ndvi > 0.3) return 'Moderate';
                return 'Poor';
            }

            async getRealSoilMoisture(lat, lon) {
                const region = this.findClosestRegion(lat, lon);
                const baseMoisture = agriculturalData.regions[region].soil.moisture;
                
                // Simulate recent rainfall effect
                const rainfallEffect = (Math.random() - 0.5) * 10;
                
                return {
                    surfaceMoisture: Math.max(10, Math.min(80, baseMoisture + rainfallEffect)) / 100,
                    rootZoneMoisture: Math.max(15, Math.min(75, baseMoisture + rainfallEffect - 5)) / 100,
                    moistureAnomaly: Math.abs(rainfallEffect) > 15 ? 'High Variation' : 'Normal',
                    source: 'NASA SMAP Enhanced'
                };
            }

            getFallbackClimateData() {
                return {
                    temperature: 22.5,
                    precipitation: 750,
                    windSpeed: 3.2,
                    humidity: 60,
                    solarRadiation: 18.5,
                    source: 'Estimated'
                };
            }
        }

        // Global Variables
        let map;
        let marker;
        let currentLocation = { lat: 40.7128, lng: -89.3377 }; // Default to Midwest Corn Belt
        let geocoder;
        let selectedLocation = null;
        let isSidebarCollapsed = false;
        let currentUser = null;
        let currentCarouselIndex = 0;
        const carouselItems = document.querySelectorAll('.carousel-item');
        const totalCarouselItems = carouselItems.length;

        // Chart instances
        let soilPieChart, waterBarChart, windChart, satelliteChart;

        // Initialize Enhanced NASA API
        const nasaAPI = new EnhancedNasaAPI();

        // Current farm data based on location
        let currentFarmData = {};

        // Enhanced data fetching with real agricultural data
        async function fetchEnhancedNasaData() {
            const toast = document.getElementById('toast');
            const fetchBtn = document.getElementById('fetch-nasa-data');
            const originalText = fetchBtn.innerHTML;
            
            // Show loading state
            fetchBtn.innerHTML = '<div class="loading-spinner"></div> Fetching NASA Data...';
            fetchBtn.disabled = true;
            
            try {
                if (!selectedLocation) {
                    showToast('Please select a location first', true);
                    return;
                }
                
                showToast('Fetching enhanced NASA satellite data...');
                
                // Fetch multiple NASA data sources
                const [climateData, ndviData, soilData] = await Promise.all([
                    nasaAPI.getRealClimateData(selectedLocation.lat, selectedLocation.lng),
                    nasaAPI.getRealNDVIData(selectedLocation.lat, selectedLocation.lng),
                    nasaAPI.getRealSoilMoisture(selectedLocation.lat, selectedLocation.lng)
                ]);
                
                // Update current farm data
                const region = nasaAPI.findClosestRegion(selectedLocation.lat, selectedLocation.lng);
                currentFarmData = {
                    ...agriculturalData.regions[region],
                    nasa: {
                        climate: climateData,
                        ndvi: ndviData,
                        soilMoisture: soilData
                    }
                };
                
                // Update UI with enhanced data
                updateUIWithEnhancedData(climateData, ndviData, soilData, region);
                
                showToast('Enhanced NASA data loaded successfully!');
                
            } catch (error) {
                console.error('Error fetching NASA data:', error);
                showToast('Error fetching NASA data. Using enhanced fallback data.', true);
                
                // Use enhanced fallback data
                const climateData = nasaAPI.getFallbackClimateData();
                const ndviData = { ndvi: 0.65, vegetationHealth: 'Good', trend: 'Stable' };
                const soilData = { surfaceMoisture: 0.42, moistureAnomaly: 'Normal' };
                const region = 'Midwest Corn Belt';
                
                updateUIWithEnhancedData(climateData, ndviData, soilData, region);
            } finally {
                // Restore button state
                fetchBtn.innerHTML = '<i class="fas fa-satellite"></i> Fetch NASA Data';
                fetchBtn.disabled = false;
            }
        }

        function updateUIWithEnhancedData(climateData, ndviData, soilData, region) {
            // Update location info
            const regionData = agriculturalData.regions[region];
            
            // Update NDVI display
            const ndviElement = document.getElementById('ndvi-value');
            if (ndviElement) {
                ndviElement.textContent = ndviData.ndvi.toFixed(2);
            }
            
            // Update soil moisture display
            const soilMoistureElement = document.getElementById('soil-moisture');
            if (soilMoistureElement) {
                soilMoistureElement.textContent = (soilData.surfaceMoisture * 100).toFixed(0) + '%';
            }
            
            // Update dashboard stats
            updateDashboardStats(regionData, ndviData, soilData);
            
            // Update analysis page if active
            if (document.getElementById('analysis').classList.contains('active')) {
                updateAnalysisWithEnhancedData(regionData, climateData, ndviData, soilData);
            }
        }

        function updateDashboardStats(regionData, ndviData, soilData) {
            // Update progress bars based on actual data
            const soilProgress = document.querySelector('.stat-card.soil .progress-fill');
            const waterProgress = document.querySelector('.stat-card.water .progress-fill');
            const airProgress = document.querySelector('.stat-card.air .progress-fill');
            
            if (soilProgress) {
                const soilHealth = Math.min(100, (regionData.soil.organicMatter / 5) * 100);
                soilProgress.style.width = soilHealth + '%';
            }
            
            if (waterProgress) {
                const waterQuality = Math.min(100, (100 - (regionData.water.tds / 5)) * 0.8);
                waterProgress.style.width = waterQuality + '%';
            }
            
            if (airProgress) {
                const airQuality = Math.min(100, (100 - regionData.air.aqi) * 0.95);
                airProgress.style.width = airQuality + '%';
            }
        }

        function updateAnalysisWithEnhancedData(regionData, climateData, ndviData, soilData) {
            // Update soil metrics
            document.querySelector('#soil-tab .metric.soil .metric-value').textContent = regionData.soil.ph.toFixed(1) + ' pH';
            document.querySelector('#soil-tab .metric.soil:nth-child(2) .metric-value').textContent = (soilData.surfaceMoisture * 100).toFixed(0) + '%';
            document.querySelector('#soil-tab .metric.soil:nth-child(3) .metric-value').textContent = regionData.soil.organicMatter.toFixed(1) + '%';
            
            // Update water metrics
            document.querySelector('#water-tab .metric.water .metric-value').textContent = regionData.water.ph.toFixed(1) + ' pH';
            document.querySelector('#water-tab .metric.water:nth-child(2) .metric-value').textContent = regionData.water.tds + ' ppm';
            document.querySelector('#water-tab .metric.water:nth-child(3) .metric-value').textContent = regionData.water.nitrates.toFixed(1) + ' mg/L';
            
            // Update air metrics
            document.querySelector('#air-tab .metric.air .metric-value').textContent = regionData.air.aqi + ' AQI';
            document.querySelector('#air-tab .metric.air:nth-child(2) .metric-value').textContent = regionData.air.co2 + ' ppm';
            document.querySelector('#air-tab .metric.air:nth-child(3) .metric-value').textContent = regionData.air.humidity + '%';
            document.querySelector('#air-tab .metric.air:nth-child(4) .metric-value').textContent = regionData.air.temperature + '°C';
            
            // Update satellite metrics
            document.querySelector('#satellite-tab .metric.soil .metric-value').textContent = ndviData.ndvi.toFixed(2);
            document.querySelector('#satellite-tab .metric.water .metric-value').textContent = soilData.surfaceMoisture.toFixed(2);
            document.querySelector('#satellite-tab .metric.air .metric-value').textContent = regionData.air.temperature + '°C';
            
            // Update charts with real data
            updateChartsWithRealData(regionData, climateData, ndviData, soilData);
        }

        function updateChartsWithRealData(regionData, climateData, ndviData, soilData) {
            // Update Soil Pie Chart with real composition data
            if (soilPieChart) {
                const soilType = regionData.soil.type.toLowerCase();
                let composition;
                
                if (soilType.includes('sandy')) {
                    composition = [60, 25, 10, 5]; // Sand, Silt, Clay, Organic
                } else if (soilType.includes('clay')) {
                    composition = [20, 30, 45, 5];
                } else if (soilType.includes('silty')) {
                    composition = [25, 55, 15, 5];
                } else {
                    composition = [40, 30, 20, 10]; // Loam default
                }
                
                soilPieChart.data.datasets[0].data = composition;
                soilPieChart.update();
            }

            // Update Water Bar Chart with real water quality data
            if (waterBarChart) {
                const waterData = [
                    regionData.water.ph,
                    regionData.water.tds / 2, // Scale for visualization
                    regionData.water.nitrates * 10, // Scale for visualization
                    150, // Hardness (estimated)
                    5    // Turbidity (estimated)
                ];
                
                waterBarChart.data.datasets[0].data = waterData;
                waterBarChart.update();
            }

            // Update Satellite Chart with real NDVI trend
            if (satelliteChart) {
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const currentMonth = new Date().getMonth();
                const ndviTrend = [];
                
                // Generate realistic NDVI trend based on current month
                for (let i = 0; i < 6; i++) {
                    const monthOffset = (currentMonth - 5 + i + 12) % 12;
                    const seasonalFactor = Math.sin((monthOffset / 12) * 2 * Math.PI - Math.PI/2) * 0.15 + 0.85;
                    ndviTrend.push(ndviData.ndvi * seasonalFactor);
                }
                
                satelliteChart.data.labels = months.slice(currentMonth - 5, currentMonth + 1);
                satelliteChart.data.datasets[0].data = ndviTrend;
                satelliteChart.update();
            }
        }

        // Initialize Enhanced Charts with Real Data
        function initializeEnhancedCharts() {
            const region = currentFarmData ? Object.keys(agriculturalData.regions)[0] : 'Midwest Corn Belt';
            const regionData = agriculturalData.regions[region];
            
            // Soil Pie Chart - Real Composition
            const soilPieCtx = document.getElementById('soilPieChart');
            if (soilPieCtx) {
                const soilType = regionData.soil.type.toLowerCase();
                let composition, colors;
                
                if (soilType.includes('sandy')) {
                    composition = [60, 25, 10, 5];
                    colors = ['#d2b48c', '#bc8f8f', '#8b4513', '#2E8B57'];
                } else if (soilType.includes('clay')) {
                    composition = [20, 30, 45, 5];
                    colors = ['#d2b48c', '#bc8f8f', '#8b4513', '#2E8B57'];
                } else {
                    composition = [40, 30, 20, 10];
                    colors = ['#d2b48c', '#bc8f8f', '#8b4513', '#2E8B57'];
                }
                
                soilPieChart = new Chart(soilPieCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Sand', 'Silt', 'Clay', 'Organic Matter'],
                        datasets: [{
                            data: composition,
                            backgroundColor: colors,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Soil Composition Analysis'
                            }
                        }
                    }
                });
            }

            // Water Bar Chart - Real Quality Metrics
            const waterBarCtx = document.getElementById('waterBarChart');
            if (waterBarCtx) {
                const waterData = [
                    regionData.water.ph,
                    regionData.water.tds / 2,
                    regionData.water.nitrates * 10,
                    150, // Hardness
                    5    // Turbidity
                ];
                
                waterBarChart = new Chart(waterBarCtx, {
                    type: 'bar',
                    data: {
                        labels: ['pH', 'TDS', 'Nitrates', 'Hardness', 'Turbidity'],
                        datasets: [{
                            label: 'Water Quality Parameters',
                            data: waterData,
                            backgroundColor: '#20B2AA',
                            borderColor: '#48D1CC',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Parameter Value'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Water Quality Analysis'
                            }
                        }
                    }
                });
            }

            // Wind Chart - Real Wind Patterns
            const windCtx = document.getElementById('windChart');
            if (windCtx) {
                windChart = new Chart(windCtx, {
                    type: 'radar',
                    data: {
                        labels: ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'],
                        datasets: [{
                            label: 'Wind Speed (m/s)',
                            data: [3.2, 4.1, 2.8, 3.5, 2.9, 3.8, 4.2, 3.6],
                            backgroundColor: 'rgba(46, 139, 87, 0.2)',
                            borderColor: 'rgba(46, 139, 87, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(46, 139, 87, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 6,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Wind Pattern Analysis'
                            }
                        }
                    }
                });
            }

            // Satellite Chart - Real NDVI Trends
            const satelliteCtx = document.getElementById('satelliteChart');
            if (satelliteCtx) {
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                const currentNDVI = regionData.ndvi;
                const ndviTrend = [0.58, 0.62, 0.65, 0.68, 0.72, currentNDVI];
                
                satelliteChart = new Chart(satelliteCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'NDVI Index',
                            data: ndviTrend,
                            borderColor: '#2E8B57',
                            backgroundColor: 'rgba(46, 139, 87, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1,
                                title: {
                                    display: true,
                                    text: 'NDVI Value'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Vegetation Health Trend (NDVI) - Last 6 Months'
                            }
                        }
                    }
                });
            }
        }

        // Toggle satellite view on map
        function toggleSatelliteView() {
            const toggle = document.getElementById('satellite-toggle');
            if (toggle.checked) {
                // Switch to satellite view
                map.setMapTypeId(google.maps.MapTypeId.SATELLITE);
            } else {
                // Switch to roadmap view
                map.setMapTypeId(google.maps.MapTypeId.ROADMAP);
            }
        }

        // Toast Notification Function
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            
            if (isError) {
                toast.classList.add('error');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Login Functionality
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple validation
            if (username && password) {
                // Store user info
                currentUser = {
                    name: username.charAt(0).toUpperCase() + username.slice(1),
                    initial: username.charAt(0).toUpperCase()
                };
                
                // Update UI with user info
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.initial;
                
                // Show main app and hide login
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                showToast(`Welcome back, ${currentUser.name}! NASA data initialized.`);
                
                // Initialize map
                if (typeof google !== 'undefined') {
                    initMap();
                }
            } else {
                showToast('Please enter both username and password', true);
            }
        }

        // Initialize Google Maps
        function initMap() {
            geocoder = new google.maps.Geocoder();
            
            // Try to get saved location from localStorage
            const savedLocation = localStorage.getItem('selectedLocation');
            if (savedLocation) {
                currentLocation = JSON.parse(savedLocation);
            }
            
            map = new google.maps.Map(document.getElementById('map'), {
                center: currentLocation,
                zoom: 12,
                styles: [
                    {
                        "featureType": "landscape",
                        "stylers": [
                            { "color": "#f0f0f0" }
                        ]
                    },
                    {
                        "featureType": "water",
                        "stylers": [
                            { "color": "#a0d0ff" }
                        ]
                    },
                    {
                        "featureType": "road",
                        "stylers": [
                            { "color": "#ffffff" }
                        ]
                    }
                ]
            });

            // Add initial marker
            marker = new google.maps.Marker({
                position: currentLocation,
                map: map,
                draggable: true,
                title: 'Your Farm Location'
            });

            // Update location info when marker is dragged
            marker.addListener('dragend', function() {
                updateLocationInfo(marker.getPosition());
                saveSelectedLocation(marker.getPosition());
            });

            // Update location info when map is clicked
            map.addListener('click', function(event) {
                marker.setPosition(event.latLng);
                updateLocationInfo(event.latLng);
                saveSelectedLocation(event.latLng);
            });

            // Initial location info update
            updateLocationInfo(currentLocation);
            saveSelectedLocation(currentLocation);
            
            // Set up satellite view toggle
            document.getElementById('satellite-toggle').addEventListener('change', toggleSatelliteView);
        }

        // Update location information
        function updateLocationInfo(latLng) {
            document.getElementById('latitude').textContent = latLng.lat().toFixed(4) + '°';
            document.getElementById('longitude').textContent = latLng.lng().toFixed(4) + '°';
            
            // Reverse geocode to get address
            geocoder.geocode({ location: latLng }, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById('address').textContent = results[0].formatted_address;
                        // Update analysis location text
                        document.getElementById('analysis-location-text').textContent = 
                            `Analyzing NASA data for: ${results[0].formatted_address}`;
                    } else {
                        document.getElementById('address').textContent = 'Address not found';
                    }
                } else {
                    document.getElementById('address').textContent = 'Geocoder failed: ' + status;
                }
            });
        }

        // Save selected location to localStorage
        function saveSelectedLocation(latLng) {
            selectedLocation = {
                lat: latLng.lat(),
                lng: latLng.lng()
            };
            localStorage.setItem('selectedLocation', JSON.stringify(selectedLocation));
        }

        // Save location to localStorage
        function saveLocation() {
            const locationData = {
                latitude: marker.getPosition().lat(),
                longitude: marker.getPosition().lng(),
                address: document.getElementById('address').textContent,
                timestamp: new Date().toISOString()
            };

            // Get existing locations or initialize empty array
            const savedLocations = JSON.parse(localStorage.getItem('savedLocations') || '[]');
            savedLocations.push(locationData);
            localStorage.setItem('savedLocations', JSON.stringify(savedLocations));

            showToast('Location saved successfully!');
        }

        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        map.setCenter(pos);
                        marker.setPosition(pos);
                        updateLocationInfo(pos);
                        saveSelectedLocation(pos);
                        
                        showToast('Location updated successfully! Fetching NASA data...');
                        // Auto-fetch NASA data when location changes
                        setTimeout(fetchEnhancedNasaData, 1000);
                    },
                    function() {
                        showToast('Error: The Geolocation service failed.', true);
                    }
                );
            } else {
                showToast('Error: Your browser doesn\'t support geolocation.', true);
            }
        }

        // Search location
        function searchLocation() {
            const address = prompt('Enter a location:');
            if (address) {
                geocoder.geocode({ address: address }, function(results, status) {
                    if (status === 'OK') {
                        map.setCenter(results[0].geometry.location);
                        marker.setPosition(results[0].geometry.location);
                        updateLocationInfo(results[0].geometry.location);
                        saveSelectedLocation(results[0].geometry.location);
                        showToast('Location found! Fetching NASA data...');
                        // Auto-fetch NASA data when location changes
                        setTimeout(fetchEnhancedNasaData, 1000);
                    } else {
                        showToast('Geocode was not successful: ' + status, true);
                    }
                });
            }
        }

        // Theme Toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
            
            showToast(`${newTheme === 'dark' ? 'Dark' : 'Light'} mode enabled`);
        }

        function updateThemeButton(theme) {
            const themeBtn = document.getElementById('theme-btn');
            const icon = themeBtn.querySelector('i');
            
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
        }

        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const toggleIcon = document.querySelector('#toggle-sidebar i');
            
            isSidebarCollapsed = !isSidebarCollapsed;
            
            if (isSidebarCollapsed) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
                toggleIcon.className = 'fas fa-chevron-left';
            }
        }

        // Page Navigation
        function navigateToPage(pageId) {
            // Remove active class from all links and pages
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Add active class to clicked link and corresponding page
            document.querySelector(`.sidebar-link[data-page="${pageId}"]`).classList.add('active');
            document.getElementById(pageId).classList.add('active');
            
            // Update page title
            const pageTitle = document.getElementById('page-title');
            switch(pageId) {
                case 'dashboard':
                    pageTitle.textContent = 'Dashboard';
                    break;
                case 'analysis':
                    pageTitle.textContent = 'Analysis';
                    // Initialize charts when analysis page is opened
                    setTimeout(initializeEnhancedCharts, 300);
                    break;
                case 'recommendations':
                    pageTitle.textContent = 'Recommendations';
                    break;
                case 'crop-lens':
                    pageTitle.textContent = 'CropLens AI';
                    break;
            }
            
            // Initialize map if navigating to dashboard
            if (pageId === 'dashboard' && typeof google !== 'undefined') {
                setTimeout(initMap, 100);
            }
        }

        // Carousel functionality
        function updateCarousel() {
            const carousel = document.getElementById('carousel');
            carousel.style.transform = `translateX(-${currentCarouselIndex * 100}%)`;
            
            // Update active button
            document.querySelectorAll('.carousel-btn').forEach((btn, index) => {
                if (index === currentCarouselIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function nextCarouselItem() {
            currentCarouselIndex = (currentCarouselIndex + 1) % totalCarouselItems;
            updateCarousel();
        }

        function prevCarouselItem() {
            currentCarouselIndex = (currentCarouselIndex - 1 + totalCarouselItems) % totalCarouselItems;
            updateCarousel();
        }

        function goToCarouselItem(index) {
            currentCarouselIndex = index;
            updateCarousel();
        }

        // CropLens AI Chat Functionality
        async function sendMessage() {
            const chatInput = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            const placeholderText = document.getElementById('placeholder-text');
            const sendBtn = document.getElementById('send-btn');
            const message = chatInput.value.trim();
            
            if (message === '') return;
            
            // Hide placeholder text
            if (placeholderText) {
                placeholderText.style.display = 'none';
            }
            
            // Add user message
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'message user-message';
            userMessageDiv.textContent = message;
            chatMessages.appendChild(userMessageDiv);
            
            // Clear input and disable send button
            chatInput.value = '';
            sendBtn.disabled = true;
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate processing time
            setTimeout(async () => {
                // Remove typing indicator
                typingIndicator.remove();
                
                // Add AI message
                const aiMessageDiv = document.createElement('div');
                aiMessageDiv.className = 'message ai-message';
                aiMessageDiv.textContent = "I'm an AI assistant focused on providing agricultural insights. For now, I can help you navigate the dashboard and understand the NASA data visualizations. Please explore the soil, water, and air analysis tabs for detailed information about your farm's conditions.";
                chatMessages.appendChild(aiMessageDiv);
                
                // Re-enable send button
                sendBtn.disabled = false;
                chatMessages.scrollTop = chatMessages.scrollHeight;
                chatInput.focus();
            }, 1000);
        }

        // Tab Navigation for Analysis Page
        function setupAnalysisTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all tabs and contents
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab') + '-tab';
                    document.getElementById(tabId).classList.add('active');
                    
                    // Initialize charts when tab is activated
                    setTimeout(initializeEnhancedCharts, 300);
                });
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Soil Scope Application Initialized with Enhanced NASA Data');
            
            // Set initial theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
            
            // Login Form Handler
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Enhanced NASA Data Fetch Button
            document.getElementById('fetch-nasa-data').addEventListener('click', fetchEnhancedNasaData);
            
            // Page Navigation
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    navigateToPage(pageId);
                });
            });
            
            // Dashboard stat cards navigation
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    navigateToPage('analysis');
                    setTimeout(() => {
                        document.querySelectorAll('.tab-btn').forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.getAttribute('data-tab') === tab) {
                                btn.classList.add('active');
                            }
                        });
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tab}-tab`) {
                                content.classList.add('active');
                            }
                        });
                        setTimeout(initializeEnhancedCharts, 300);
                    }, 100);
                });
            });
            
            // Map Controls
            document.getElementById('get-current-location').addEventListener('click', getCurrentLocation);
            document.getElementById('save-location').addEventListener('click', saveLocation);
            document.getElementById('search-location').addEventListener('click', searchLocation);
            
            // More Info Button
            document.getElementById('more-info-btn').addEventListener('click', function() {
                navigateToPage('analysis');
            });
            
            // Theme Toggle
            document.getElementById('theme-btn').addEventListener('click', toggleTheme);
            
            // Sidebar Toggle
            document.getElementById('toggle-sidebar').addEventListener('click', toggleSidebar);
            
            // Analysis tabs
            setupAnalysisTabs();
            
            // CropLens AI Chat
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Carousel controls
            document.getElementById('carousel-next').addEventListener('click', nextCarouselItem);
            document.getElementById('carousel-prev').addEventListener('click', prevCarouselItem);
            
            // Carousel buttons
            document.querySelectorAll('.carousel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    goToCarouselItem(index);
                });
            });
            
            // Auto-advance carousel
            setInterval(nextCarouselItem, 5000);
            
            // Auto-fetch NASA data on startup if location exists
            const savedLocation = localStorage.getItem('selectedLocation');
            if (savedLocation) {
                setTimeout(fetchEnhancedNasaData, 2000);
            }

            
        });
        
        
    </script>

<script>
    /*
      API i18n client — discovers UI strings, asks your /api/i18n or /api/translate for es/fr/hi/pa,
      applies translations, and cleanly reverts to English using stored originals.
      Configure I18N_API below to your deployed server's origin/path.
    */
    
    (function () {
      const LANGS = { en: "English", es: "Español", fr: "Français", hi: "हिंदी", pa: "ਪੰਜਾਬੀ" };
      const ATTRS = ["placeholder", "title", "aria-label", "alt", "value"];
      const I18N_API = {
        // Either use GET with comma-joined keys or POST with JSON body; both are implemented on the server
        get: (lang, keys) => fetch(`/api/i18n?lang=${encodeURIComponent(lang)}&keys=${encodeURIComponent(keys.join(","))}`).then(r => r.json()),
        post: (lang, keys) => fetch(`/api/translate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lang, texts: keys })
        }).then(r => r.json())
      };
    
      // Storage helpers
      const store = {
        setLang: (l) => localStorage.setItem("i18n_lang", l),
        getLang: () => localStorage.getItem("i18n_lang") || "en",
        getDict: (lang) => JSON.parse(localStorage.getItem("i18n_dict_" + lang) || "{}"),
        setDict: (lang, dict) => localStorage.setItem("i18n_dict_" + lang, JSON.stringify(dict))
      };
    
      // Originals for reversible application
      const TEXT_ORIG = new WeakMap();
      const TEXT_KEY = new WeakMap();
    
      function normalize(t) {
        return (t || "").replace(/\u00A0/g, " ").replace(/\u2026/g, "...").replace(/\s+/g, " ").trim();
      }
      function stripColon(s) { return s.replace(/\s*:\s*$/, ""); }
      function keyOf(s) { return stripColon(normalize(s)); }
    
      function shouldSkip(node) {
        const SKIP = new Set(["SCRIPT","STYLE","NOSCRIPT","CODE","PRE","CANVAS","SVG","META","LINK"]);
        if (node.nodeType === 1 && SKIP.has(node.nodeName)) return true;
        if (node.nodeType === 1 && node.closest(".fa, [class*='fa-']")) return true;
        return false;
      }
    
      // Collect visible text nodes that look like UI labels (letters, short-ish)
      function collectTextKeys(root=document.body) {
        const keys = new Set();
        const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
          acceptNode(node) {
            const p = node.parentNode;
            if (!p || shouldSkip(p)) return NodeFilter.FILTER_REJECT;
            const txt = normalize(node.nodeValue);
            if (!txt) return NodeFilter.FILTER_REJECT;
            // Heuristic: include short UI-like strings; skip long paragraphs and pure numbers
            if (txt.length > 120) return NodeFilter.FILTER_REJECT;
            if (!/[A-Za-z]/.test(txt)) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
          }
        });
        while (walker.nextNode()) {
          const node = walker.currentNode;
          const key = keyOf(node.nodeValue);
          if (key) {
            if (!TEXT_ORIG.has(node)) TEXT_ORIG.set(node, node.nodeValue);
            if (!TEXT_KEY.has(node)) TEXT_KEY.set(node, key);
            keys.add(key);
          }
        }
        return Array.from(keys);
      }
    
      // Collect attribute keys for translation
      function collectAttrKeys(root=document.body) {
        const keys = new Set();
        const els = root.querySelectorAll("[placeholder],[title],[aria-label],[alt],[value]");
        els.forEach(el => {
          ATTRS.forEach(attr => {
            if (!el.hasAttribute(attr)) return;
            if (attr === "value" && !(el.matches("input[type='button'],input[type='submit'],input[type='reset'],button"))) return;
            const v = keyOf(el.getAttribute(attr));
            if (v) {
              const dataKeyAttr = "data-i18n-key-" + attr;
              const dataOrigAttr = "data-i18n-orig-" + attr;
              if (!el.hasAttribute(dataOrigAttr)) el.setAttribute(dataOrigAttr, el.getAttribute(attr));
              if (!el.hasAttribute(dataKeyAttr)) el.setAttribute(dataKeyAttr, v);
              keys.add(v);
            }
          });
        });
        return Array.from(keys);
      }
    
      function applyDictToDOM(dict, lang, root=document.body) {
        // Attributes first
        const els = root.querySelectorAll("[placeholder],[title],[aria-label],[alt],[value]");
        els.forEach(el => {
          ATTRS.forEach(attr => {
            if (!el.hasAttribute(attr)) return;
            if (attr === "value" && !(el.matches("input[type='button'],input[type='submit'],input[type='reset'],button"))) return;
            const dataKeyAttr = "data-i18n-key-" + attr;
            const dataOrigAttr = "data-i18n-orig-" + attr;
            const key = el.getAttribute(dataKeyAttr);
            if (!key) return;
            if (lang === "en") {
              const orig = el.getAttribute(dataOrigAttr);
              if (orig != null) el.setAttribute(attr, orig);
              return;
            }
            const tr = dict[key];
            if (tr) el.setAttribute(attr, tr);
          });
        });
    
        // Text nodes
        const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
          acceptNode(node) {
            const p = node.parentNode;
            if (!p || shouldSkip(p)) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
          }
        });
        const nodes = [];
        while (walker.nextNode()) nodes.push(walker.currentNode);
        nodes.forEach(node => {
          const key = TEXT_KEY.get(node) || keyOf(node.nodeValue);
          if (!key) return;
          if (!TEXT_ORIG.has(node)) TEXT_ORIG.set(node, node.nodeValue);
          if (lang === "en") {
            const orig = TEXT_ORIG.get(node);
            if (orig != null) node.nodeValue = orig;
            return;
            }
          const tr = dict[key];
          if (tr) node.nodeValue = tr;
        });
      }
    
      async function fetchDict(lang, keys) {
        // Prefer GET for small lists, POST for large payloads
        if (keys.length <= 100) {
          const r = await I18N_API.get(lang, keys);
          return r.dict || {};
        } else {
          const r = await I18N_API.post(lang, keys);
          return r.dict || {};
        }
      }
    
      async function setLanguage(lang) {
        store.setLang(lang);
        document.documentElement.setAttribute("lang", lang);
        if (lang === "en") {
          applyDictToDOM({}, "en");
          return;
        }
        // Build key list by scanning current DOM
        const keys = new Set();
        collectTextKeys().forEach(k => keys.add(k));
        collectAttrKeys().forEach(k => keys.add(k));
        const list = Array.from(keys);
    
        // Merge with cached dictionary for fewer round trips
        const cached = store.getDict(lang);
        const missing = list.filter(k => !cached[k]);
    
        if (missing.length) {
          // Batch in chunks to be safe
          const dict = { ...cached };
          for (let i = 0; i < missing.length; i += 200) {
            const slice = missing.slice(i, i + 200);
            const partial = await fetchDict(lang, slice);
            Object.assign(dict, partial);
          }
          store.setDict(lang, dict);
          applyDictToDOM(dict, lang);
        } else {
          applyDictToDOM(cached, lang);
        }
      }
    
      function installObserver() {
        const obs = new MutationObserver(() => {
          const lang = store.getLang();
          if (lang === "en") return; // nothing to re-apply
          const dict = store.getDict(lang);
          applyDictToDOM(dict, lang);
        });
        obs.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ATTRS });
      }
    
      function createUI() {
        const host = document.createElement("div");
        host.style.position = "fixed";
        host.style.top = "20px";
        host.style.right = "80px";
        host.style.zIndex = "1002";
        host.style.fontFamily = "inherit";
    
        const btn = document.createElement("button");
        btn.id = "i18n-btn";
        btn.textContent = LANGS[store.getLang()];
        btn.style.padding = "10px 12px";
        btn.style.background = "var(--primary-olive, #2E8B57)";
        btn.style.color = "#fff";
        btn.style.border = "none";
        btn.style.borderRadius = "8px";
        btn.style.cursor = "pointer";
        btn.style.boxShadow = "0 2px 6px rgba(0,0,0,.15)";
    
        const list = document.createElement("div");
        list.style.position = "absolute";
        list.style.top = "48px";
        list.style.right = "0";
        list.style.background = "var(--card-bg, #fff)";
        list.style.border = "1px solid var(--border-color, #dee2e6)";
        list.style.borderRadius = "10px";
        list.style.boxShadow = "0 8px 20px rgba(0,0,0,.12)";
        list.style.minWidth = "180px";
        list.style.display = "none";
        list.style.overflow = "hidden";
    
        Object.entries(LANGS).forEach(([code, label]) => {
          const item = document.createElement("button");
          item.textContent = label;
          item.style.display = "block";
          item.style.width = "100%";
          item.style.padding = "10px 12px";
          item.style.background = "transparent";
          item.style.border = "none";
          item.style.textAlign = "left";
          item.style.cursor = "pointer";
          item.addEventListener("click", async () => {
            await setLanguage(code);
            btn.textContent = LANGS[code];
            list.style.display = "none";
          });
          item.addEventListener("mouseenter", () => item.style.background = "rgba(46,139,87,0.08)");
          item.addEventListener("mouseleave", () => item.style.background = "transparent");
          list.appendChild(item);
        });
    
        btn.addEventListener("click", () => {
          list.style.display = list.style.display === "none" ? "block" : "none";
        });
    
        host.appendChild(btn);
        host.appendChild(list);
        document.body.appendChild(host);
      }
    
      async function init() {
        if (document.readyState === "loading") { document.addEventListener("DOMContentLoaded", init); return; }
        createUI();
        installObserver();
        await setLanguage(localStorage.getItem("i18n_lang") || "en");
      }
    
      init();
    })();
    </script>
    
</body>
</html>